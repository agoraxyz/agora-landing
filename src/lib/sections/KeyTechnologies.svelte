<script>
  import { onMount } from 'svelte';

  let windowWidth;
  let windowHeight;
  let scrollY;
  let videoContainer;
  let videoSrc;
  let video;
  let shouldPlay = true;
  let isSafari = false;

  const scrollHandler = () => {
    if (!shouldPlay) return;
    const rect = videoContainer.getBoundingClientRect();
    if (rect.bottom < windowHeight) {
      video.play();
      shouldPlay = false;
    }
  };

  onMount(() => {
    isSafari =
      navigator?.userAgent?.indexOf('Safari') !== -1 &&
      navigator?.userAgent?.indexOf('Chrome') === -1;

    if (windowWidth > 768) {
      videoSrc = '/animations/key-technologies.webm';
    } else {
      videoSrc = '/animations/mobile-key-technologies.webm';
    }
  });
</script>

<svelte:window
  bind:innerWidth={windowWidth}
  bind:innerHeight={windowHeight}
  bind:scrollY
  on:scroll={scrollHandler}
/>

<section id="key-technologies" class="relative bg-agora-blue-medium text-agora-white">
  <div class="container relative pt-24 text-center lg:pb-24">
    <div
      class="relative z-10 mx-auto max-w-lg lg:mx-0 lg:grid lg:max-w-screen-md lg:grid-cols-2 lg:gap-16 lg:text-left"
    >
      <h2
        class="mb-8 font-display text-3xl font-bold uppercase tracking-tight text-agora-pink-light lg:col-span-2 lg:text-4xl 2xl:text-5xl"
      >
        Key technologies
      </h2>
      <div>
        <h3
          class="mb-2 font-display text-xl font-bold uppercase tracking-tight lg:mb-3 lg:text-2xl"
        >
          Social Oracle Layer
        </h3>
        <p class="mb-8 lg:font-semibold 2xl:text-lg">
          Two way social media integration Powered by Witnet to the blockchain creating a circular
          information flow.
        </p>

        <h3
          class="mb-2 font-display text-xl font-bold uppercase tracking-tight lg:mb-3 lg:text-2xl"
        >
          On-chain Privacy
        </h3>
        <p class="mb-8 lg:font-semibold 2xl:text-lg">
          Zero knowledge based self-sovereign identity management system for keeping the link
          between your social media accounts and wallets private. This allows a private decision
          making and sybil attack resistency for many cases.
        </p>
      </div>

      <div>
        <h3
          class="mb-2 font-display text-xl font-bold uppercase tracking-tight lg:mb-3 lg:text-2xl"
        >
          Permissionless Tools
        </h3>
        <p class="mb-8 lg:font-semibold 2xl:text-lg">Fully open-source, hosted on IPFS.</p>

        <h3
          class="mb-2 font-display text-xl font-bold uppercase tracking-tight lg:mb-3 lg:text-2xl"
        >
          Customizable
        </h3>
        <p class="mb-8 lg:font-semibold 2xl:text-lg">
          Spaces can have their own custom domain name and unique appearance.
        </p>

        <h3
          class="mb-2 font-display text-xl font-bold uppercase tracking-tight lg:mb-3 lg:text-2xl"
        >
          Multi-chain
        </h3>
        <p class="lg:font-semibold 2xl:text-lg">
          We integrate every major EVM-compatible blockchains and L2s besides Solana and Near.
        </p>
      </div>
    </div>

    <div
      class="w-full lg:absolute lg:bottom-0 lg:-right-20 lg:w-2/5 xl:right-0"
      bind:this={videoContainer}
    >
      {#if isSafari}
        <picture>
          <source srcset="/images/pegasus.webp" type="image/webp" />
          <source srcset="/images/png/pegasus.png" type="image/png" />
          <img src="/images/png/pegasus.png" alt="Pegasus" width="100%" height="auto" />
        </picture>
      {:else}
        <video
          poster="/images/pegasus.webp"
          playsinline
          muted
          preload="auto"
          width="100%"
          height="auto"
          bind:this={video}
        >
          <source src={videoSrc} type="video/webm" />
          <img src="/images/png/pegasus.png" alt="Pegasus" width="100%" height="auto" />
        </video>
      {/if}
    </div>
  </div>
</section>
